<%= link_to 'New Listing', new_listing_path %>

<h2>Listings</h2>

<div id="listings-container" class="container">

  <% @listings.each_with_index do |listing, index| %>
    <%# i is the index of listing in @listings %>

    <% if index == 0 # the very first listing %>
      <div class="row"><!-- open .row -->
    <% end %>

    <%# first listing in the row (excluding the very first listing) %>
    <% if listing != @listings.first && (index + 1) % 3 == 1 %>
      </div><!-- close ."row" -->
      <div class="row"><!-- open .row -->
    <% end %>

    <div class="col-sm"><!-- open column -->
      <div class="listing-image">
        <% unless listing.picture.attached? %>
          <%= link_to image_tag('defaultbox.jpg', class: "img-thumbnail"), listing %>
        <% else %>
          <%= link_to image_tag(listing.picture), listing %>
        <% end %>
      </div><!-- end of .listing-image -->

      <div class="listing-content">
        <p><%= listing.title %></p>
        <p><%= listing.price %></p>
        <% if @mark == "yes" %>
          <%= current_user.phone_number %>
        <% end %>
        <p><%= link_to 'Show', listing %></p>
        <% if listing.user == current_user %>
          <p><%= link_to 'Edit', edit_listing_path(listing) %></p>
          <p><%= link_to 'Destroy', listing, method: :delete, data: { confirm: 'Are you sure?' } %></p>
        <% end %>
        </div><!-- end of .listing-content -->
      </div><!-- close column -->

    <% if listing == @listings.last %>
      <% remaining_columns = 3 - (@listings.count % 3) %>
      <% if remaining_columns > 0 && remaining_columns < 3 %>
        <% remaining_columns.each do %>
          <div class="col-sm"></div>
        <% end %>
      <% end %>
      </div><!-- close .row -->
    <% end %>

  <% end # @listing.each_with_index%>
</div>